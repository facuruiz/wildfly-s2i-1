    ##comienzo Template
  apiVersion: v1
  kind: Template
  metadata:
    name: wildlfy-s2i-mvilche
    labels:
      template: wildlfy-s2i-mvilche
      autor: "Martin_Fabrizzio_Vilche"
    annotations:
      openshift.io/display-name: "wildlfy-s2i-mvilche"
      iconClass: "icon-wildfly"
      description: >-
        Compilador de imagenes para microservicios basados en java 11 y maven 3.6.0
        Martin Fabrizzio Vilche.
        https://github.com/mvilche.

  objects:

  - apiVersion: v1
    kind: DeploymentConfig
    metadata:
      labels:
        app: "${APP_NAME}"
      name: "${APP_NAME}"
    spec:
      replicas: 1
      revisionHistoryLimit: 10
      selector:
        app: ${APP_NAME}
        deploymentconfig: ${APP_NAME}
      strategy:
        activeDeadlineSeconds: 21600
        resources: {}
        rollingParams:
          intervalSeconds: 1
          maxSurge: 25%
          maxUnavailable: 25%
          timeoutSeconds: 600
          updatePeriodSeconds: 1
        type: Rolling
      template:
        metadata:
          labels:
            app: ${APP_NAME}
            deploymentconfig: ${APP_NAME}
        spec:
          containers:
            - env:
                - name: CUSTOM_JAVA_OPTS
                  value: ${CUSTOM_JAVA_OPTS}
              image: "${APP_NAME}:latest"
              imagePullPolicy: Always
              name: ${APP_NAME}
              ports:
                - containerPort: 8080
                  protocol: TCP
                - containerPort: 8778
                  protocolo: TCP
                  name: jolokia
              livenessProbe:
                failureThreshold: 3
                initialDelaySeconds: 60
                periodSeconds: 20
                successThreshold: 1
                httpGet:
                  port: 8080
                  path: /
                timeoutSeconds: 15
              readinessProbe:
                failureThreshold: 3
                initialDelaySeconds: 60
                periodSeconds: 20
                successThreshold: 1
                httpGet:
                  port: 8080
                  path: /
                timeoutSeconds: 15
              resources:
                requests:
                  cpu: 500m
                  memory: 1Gi
                limits:
                  cpu: 1
                  memory: 2Gi
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
              volumeMounts:
                - mountPath: /opt/wildfly/standalone/configuration/custom/
                  name: configmap-1
          dnsPolicy: ClusterFirst
          restartPolicy: Always
          schedulerName: default-scheduler
          terminationGracePeriodSeconds: 30
          volumes:
            - configMap:
                defaultMode: 420
                items:
                  - key: standalone.xml
                    path: standalone.xml
                name: standalone.xml
              name: configmap-1
      test: false
      triggers:
        - type: ConfigChange
        - imageChangeParams:
            automatic: true
            containerNames:
              - ${APP_NAME}
            from:
              kind: ImageStreamTag
              name: "${APP_NAME}:latest"
          type: ImageChange

  - apiVersion: v1
    kind: BuildConfig
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}-s2i
    spec:
      completionDeadlineSeconds: 1800
      failedBuildsHistoryLimit: 5
      nodeSelector: null
      output:
        to:
          kind: ImageStreamTag
          name: ${APP_NAME}-s2i:latest
      postCommit: {}
      resources: {}
      runPolicy: Serial
      source:
        git:
          uri: ${REPO_GIT}
          ref: ${BRANCH_GIT}
        type: Git
        sourceSecret:
          name: ${SOURCE_SECRET}
      strategy:
        sourceStrategy:
          incremental: true
          env:
            - name: NEXUS_MIRROR_URL
              value: ${NEXUS_MIRROR_URL}
            - name: EXTRA_REPO
              value: ${EXTRA_REPO}
            - name: MVN_OPTS
              value: ${MVN_OPTS}
            - name: JAVA_OPTS
              value: ${JAVA_OPTS}
          from:
            kind: ImageStreamTag
            name: wildfly-${WILDFLY_VERSION}-s2i:latest
        type: Source
      successfulBuildsHistoryLimit: 5
      triggers:
        - type: ConfigChange




  - apiVersion: v1
    kind: BuildConfig
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}-runtime
    spec:
      completionDeadlineSeconds: 1800
      output:
        to:
          kind: ImageStreamTag
          name: ${APP_NAME}:latest
      source:
        type: Dockerfile
        dockerfile: |-
                FROM wildfly-${WILDFLY_VERSION}-runtime:latest
                COPY deployments /opt/wildfly/standalone/deployments
                USER root
                RUN chown 1001:0 -R /opt/wildfly/standalone/deployments
                USER 1001
        images:
        - from:
            kind: ImageStreamTag
            name: ${APP_NAME}-s2i:latest
          paths:
          - sourcePath: /opt/wildfly/standalone/deployments
            destinationDir: "."
      strategy:
        dockerStrategy:
          from:
            kind: ImageStreamTag
            name: wildfly-${WILDFLY_VERSION}-runtime:latest
        type: Docker
      triggers:
      - type: "imageChange"
        imageChange:
          from:
            kind: "ImageStreamTag"
            name: "${APP_NAME}-s2i:latest"



  - apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}
    spec:
      ports:
        - name: http
          port: 8080
          protocol: TCP
          targetPort: 8080
        - name: jolokia
          port: 8778
          protocol: TCP
          targetPort: 8778
        - name: ajp
          port: 8009
          protocol: TCP
          targetPort: 8009
      selector:
        app: ${APP_NAME}
        deploymentconfig: ${APP_NAME}
      sessionAffinity: None
      type: ClusterIP


  - apiVersion: v1
    kind: Route
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}-http
    spec:
      port:
        targetPort: http
      to:
        kind: Service
        name: ${APP_NAME}
        weight: 100
      wildcardPolicy: None



  - apiVersion: v1
    kind: Route
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}-jolokia
    spec:
      port:
        targetPort: jolokia
      path: /jolokia
      to:
        kind: Service
        name: ${APP_NAME}
        weight: 100
      wildcardPolicy: None


  - apiVersion: v1
    kind: ImageStream
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}
    spec: {}

  - apiVersion: v1
    kind: ImageStream
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}-s2i
    spec: {}


######
  - apiVersion: v1
    kind: BuildConfig
    metadata:
      labels:
        app: ${APP_NAME}
        build: wildfly-${WILDFLY_VERSION}-s2i
      name: wildfly-${WILDFLY_VERSION}-s2i
    spec:
      failedBuildsHistoryLimit: 5
      nodeSelector: null
      output:
        to:
          kind: ImageStreamTag
          name: 'wildfly-${WILDFLY_VERSION}-s2i:latest'
      postCommit: {}
      resources: {}
      runPolicy: Serial
      source:
        contextDir: ${WILDFLY_VERSION}/jdk${VERSION_JDK}
        git:
          ref: master
          uri: 'https://github.com/mvilche/wildfly-s2i.git'
        type: Git
      strategy:
        dockerStrategy:
          dockerfilePath: Dockerfile
        type: Docker
      successfulBuildsHistoryLimit: 5
      triggers:
        - type: ConfigChange


  - apiVersion: v1
    kind: ImageStream
    metadata:
      labels:
        app: ${APP_NAME}
      name: wildfly-${WILDFLY_VERSION}-s2i
    spec: {}

  - apiVersion: v1
    kind: BuildConfig
    metadata:
      labels:
        app: ${APP_NAME}
      name: wildfly-${WILDFLY_VERSION}-runtime
    spec:
      failedBuildsHistoryLimit: 5
      nodeSelector: null
      output:
        to:
          kind: ImageStreamTag
          name: 'wildfly-${WILDFLY_VERSION}-runtime:latest'
      postCommit: {}
      resources: {}
      runPolicy: Serial
      source:
        contextDir: ${WILDFLY_VERSION}/jre${VERSION_JDK}
        git:
          ref: master
          uri: 'https://github.com/mvilche/wildfly-s2i.git'
        type: Git
      strategy:
        dockerStrategy:
          dockerfilePath: Dockerfile
        type: Docker
      successfulBuildsHistoryLimit: 5
      triggers:
        - type: ConfigChange

  - apiVersion: v1
    kind: ImageStream
    metadata:
      labels:
        app: ${APP_NAME}
      name: wildfly-${WILDFLY_VERSION}-runtime
    spec: {}


  - apiVersion: v1
    data:
      standalone.xml: "<?xml version='1.0' encoding='UTF-8'?>\n\n<server xmlns=\"urn:jboss:domain:9.0\">\n    <extensions>\n        <extension module=\"org.jboss.as.clustering.infinispan\"/>\n        <extension module=\"org.jboss.as.connector\"/>\n        <extension module=\"org.jboss.as.deployment-scanner\"/>\n        <extension module=\"org.jboss.as.ee\"/>\n        <extension module=\"org.jboss.as.ejb3\"/>\n        <extension module=\"org.jboss.as.jaxrs\"/>\n        <extension module=\"org.jboss.as.jdr\"/>\n        <extension module=\"org.jboss.as.jmx\"/>\n        <extension module=\"org.jboss.as.jpa\"/>\n        <extension module=\"org.jboss.as.jsf\"/>\n        <extension module=\"org.jboss.as.logging\"/>\n        <extension module=\"org.jboss.as.mail\"/>\n        <extension module=\"org.jboss.as.naming\"/>\n        <extension module=\"org.jboss.as.pojo\"/>\n        <extension module=\"org.jboss.as.remoting\"/>\n        <extension module=\"org.jboss.as.sar\"/>\n        <extension module=\"org.jboss.as.security\"/>\n        <extension module=\"org.jboss.as.transactions\"/>\n        <extension module=\"org.jboss.as.webservices\"/>\n        <extension module=\"org.jboss.as.weld\"/>\n        <extension module=\"org.wildfly.extension.batch.jberet\"/>\n        <extension module=\"org.wildfly.extension.bean-validation\"/>\n        <extension module=\"org.wildfly.extension.core-management\"/>\n        <extension module=\"org.wildfly.extension.discovery\"/>\n        <extension module=\"org.wildfly.extension.ee-security\"/>\n        <extension module=\"org.wildfly.extension.elytron\"/>\n        <extension module=\"org.wildfly.extension.io\"/>\n        <extension module=\"org.wildfly.extension.microprofile.config-smallrye\"/>\n        <extension module=\"org.wildfly.extension.microprofile.health-smallrye\"/>\n        <extension module=\"org.wildfly.extension.microprofile.metrics-smallrye\"/>\n        <extension module=\"org.wildfly.extension.microprofile.opentracing-smallrye\"/>\n        <extension module=\"org.wildfly.extension.request-controller\"/>\n        <extension module=\"org.wildfly.extension.security.manager\"/>\n        <extension module=\"org.wildfly.extension.undertow\"/>\n    </extensions>\n    <management>\n        <security-realms>\n            <security-realm name=\"ManagementRealm\">\n                <authentication>\n                    <local default-user=\"$local\" skip-group-loading=\"true\"/>\n                    <properties path=\"mgmt-users.properties\" relative-to=\"jboss.server.config.dir\"/>\n                </authentication>\n                <authorization map-groups-to-roles=\"false\">\n                    <properties path=\"mgmt-groups.properties\" relative-to=\"jboss.server.config.dir\"/>\n                </authorization>\n            </security-realm>\n            <security-realm name=\"ApplicationRealm\">\n                <server-identities>\n                    <ssl>\n                        <keystore path=\"application.keystore\" relative-to=\"jboss.server.config.dir\" keystore-password=\"password\" alias=\"server\" key-password=\"password\" generate-self-signed-certificate-host=\"localhost\"/>\n                    </ssl>\n                </server-identities>\n                <authentication>\n                    <local default-user=\"$local\" allowed-users=\"*\" skip-group-loading=\"true\"/>\n                    <properties path=\"application-users.properties\" relative-to=\"jboss.server.config.dir\"/>\n                </authentication>\n                <authorization>\n                    <properties path=\"application-roles.properties\" relative-to=\"jboss.server.config.dir\"/>\n                </authorization>\n            </security-realm>\n        </security-realms>\n        <audit-log>\n            <formatters>\n                <json-formatter name=\"json-formatter\"/>\n            </formatters>\n            <handlers>\n                <file-handler name=\"file\" formatter=\"json-formatter\" path=\"audit-log.log\" relative-to=\"jboss.server.data.dir\"/>\n            </handlers>\n            <logger log-boot=\"true\" log-read-only=\"false\" enabled=\"false\">\n                <handlers>\n                    <handler name=\"file\"/>\n                </handlers>\n            </logger>\n        </audit-log>\n        <management-interfaces>\n            <http-interface security-realm=\"ManagementRealm\">\n                <http-upgrade enabled=\"true\"/>\n                <socket-binding http=\"management-http\"/>\n            </http-interface>\n        </management-interfaces>\n        <access-control provider=\"simple\">\n            <role-mapping>\n                <role name=\"SuperUser\">\n                    <include>\n                        <user name=\"$local\"/>\n                    </include>\n                </role>\n            </role-mapping>\n        </access-control>\n    </management>\n    <profile>\n        <subsystem xmlns=\"urn:jboss:domain:logging:6.0\">\n            <console-handler name=\"CONSOLE\">\n                <level name=\"INFO\"/>\n                <formatter>\n                    <named-formatter name=\"COLOR-PATTERN\"/>\n                </formatter>\n            </console-handler>\n            <periodic-rotating-file-handler name=\"FILE\" autoflush=\"true\">\n                <formatter>\n                    <named-formatter name=\"PATTERN\"/>\n                </formatter>\n                <file relative-to=\"jboss.server.log.dir\" path=\"server.log\"/>\n                <suffix value=\".yyyy-MM-dd\"/>\n                <append value=\"true\"/>\n            </periodic-rotating-file-handler>\n            <logger category=\"com.arjuna\">\n                <level name=\"WARN\"/>\n            </logger>\n            <logger category=\"io.jaegertracing.Configuration\">\n                <level name=\"WARN\"/>\n            </logger>\n            <logger category=\"org.jboss.as.config\">\n                <level name=\"DEBUG\"/>\n            </logger>\n            <logger category=\"sun.rmi\">\n                <level name=\"WARN\"/>\n            </logger>\n            <root-logger>\n                <level name=\"INFO\"/>\n                <handlers>\n                    <handler name=\"CONSOLE\"/>\n                    <handler name=\"FILE\"/>\n                </handlers>\n            </root-logger>\n            <formatter name=\"PATTERN\">\n                <pattern-formatter pattern=\"%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n\"/>\n            </formatter>\n            <formatter name=\"COLOR-PATTERN\">\n                <pattern-formatter pattern=\"%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n\"/>\n            </formatter>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:batch-jberet:2.0\">\n            <default-job-repository name=\"in-memory\"/>\n            <default-thread-pool name=\"batch\"/>\n            <job-repository name=\"in-memory\">\n                <in-memory/>\n            </job-repository>\n            <thread-pool name=\"batch\">\n                <max-threads count=\"10\"/>\n                <keepalive-time time=\"30\" unit=\"seconds\"/>\n            </thread-pool>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:bean-validation:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:core-management:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:datasources:5.0\">\n            <datasources>\n                <datasource jndi-name=\"java:jboss/datasources/ExampleDS\" pool-name=\"ExampleDS\" enabled=\"true\" use-java-context=\"true\">\n                    <connection-url>jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE</connection-url>\n                    <driver>h2</driver>\n                    <security>\n                        <user-name>sa</user-name>\n                        <password>sa</password>\n                    </security>\n                </datasource>\n               <!-- <datasource jndi-name=\"java:jboss/datasources/${env.OPENSHIFT_POSTGRESQL_DATASOURCE}\" enabled=\"${postgresql.enabled}\" use-java-context=\"true\" pool-name=\"${env.OPENSHIFT_POSTGRESQL_DATASOURCE}\" use-ccm=\"true\">\n                    <connection-url>jdbc:postgresql://${env.OPENSHIFT_POSTGRESQL_DB_HOST}:${env.OPENSHIFT_POSTGRESQL_DB_PORT}/${env.OPENSHIFT_POSTGRESQL_DB_NAME}</connection-url>\n                    <driver>postgresql</driver>\n                    <security>\n                      <user-name>${env.OPENSHIFT_POSTGRESQL_DB_USERNAME}</user-name>\n                      <password>${env.OPENSHIFT_POSTGRESQL_DB_PASSWORD}</password>\n                    </security>\n                    <validation>\n                        <check-valid-connection-sql>SELECT 1</check-valid-connection-sql>\n                        <background-validation>true</background-validation>\n                        <background-validation-millis>60000</background-validation-millis>\n                        <validate-on-match>true</validate-on-match>\n                    </validation>\n                    <pool>\n                        <flush-strategy>IdleConnections</flush-strategy>\n                    </pool>\n\t    </datasource> -->\n                <drivers>\n                    <driver name=\"h2\" module=\"com.h2database.h2\">\n                        <xa-datasource-class>org.h2.jdbcx.JdbcDataSource</xa-datasource-class>\n                    </driver>\n                    <driver name=\"mysql\" module=\"com.mysql.jdbc\">\n                        <xa-datasource-class>com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</xa-datasource-class>\n                    </driver>\n                    <driver name=\"postgresql\" module=\"org.postgresql.jdbc\">\n                        <xa-datasource-class>org.postgresql.xa.PGXADataSource</xa-datasource-class>\n\t\t</driver>\n                    <driver name=\"oracle\" module=\"com.oracle\">\n\t                <driver-class>oracle.jdbc.driver.OracleDriver</driver-class>\n\t\t        <xa-datasource-class>oracle.jdbc.xa.client.OracleXADataSource</xa-datasource-class>\n\t\t</driver>\n                </drivers>\n            </datasources>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:deployment-scanner:2.0\">\n            <deployment-scanner path=\"deployments\" relative-to=\"jboss.server.base.dir\" scan-interval=\"5000\" runtime-failure-causes-rollback=\"${jboss.deployment.scanner.rollback.on.failure:false}\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:discovery:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:ee:4.0\">\n            <spec-descriptor-property-replacement>false</spec-descriptor-property-replacement>\n            <concurrent>\n                <context-services>\n                    <context-service name=\"default\" jndi-name=\"java:jboss/ee/concurrency/context/default\" use-transaction-setup-provider=\"true\"/>\n                </context-services>\n                <managed-thread-factories>\n                    <managed-thread-factory name=\"default\" jndi-name=\"java:jboss/ee/concurrency/factory/default\" context-service=\"default\"/>\n                </managed-thread-factories>\n                <managed-executor-services>\n                    <managed-executor-service name=\"default\" jndi-name=\"java:jboss/ee/concurrency/executor/default\" context-service=\"default\" hung-task-threshold=\"60000\" keepalive-time=\"5000\"/>\n                </managed-executor-services>\n                <managed-scheduled-executor-services>\n                    <managed-scheduled-executor-service name=\"default\" jndi-name=\"java:jboss/ee/concurrency/scheduler/default\" context-service=\"default\" hung-task-threshold=\"60000\" keepalive-time=\"3000\"/>\n                </managed-scheduled-executor-services>\n            </concurrent>\n            <default-bindings context-service=\"java:jboss/ee/concurrency/context/default\" datasource=\"java:jboss/datasources/ExampleDS\" managed-executor-service=\"java:jboss/ee/concurrency/executor/default\" managed-scheduled-executor-service=\"java:jboss/ee/concurrency/scheduler/default\" managed-thread-factory=\"java:jboss/ee/concurrency/factory/default\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:ee-security:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:ejb3:5.0\">\n            <session-bean>\n                <stateless>\n                    <bean-instance-pool-ref pool-name=\"slsb-strict-max-pool\"/>\n                </stateless>\n                <stateful default-access-timeout=\"5000\" cache-ref=\"simple\" passivation-disabled-cache-ref=\"simple\"/>\n                <singleton default-access-timeout=\"5000\"/>\n            </session-bean>\n            <pools>\n                <bean-instance-pools>\n                    <strict-max-pool name=\"mdb-strict-max-pool\" derive-size=\"from-cpu-count\" instance-acquisition-timeout=\"5\" instance-acquisition-timeout-unit=\"MINUTES\"/>\n                    <strict-max-pool name=\"slsb-strict-max-pool\" derive-size=\"from-worker-pools\" instance-acquisition-timeout=\"5\" instance-acquisition-timeout-unit=\"MINUTES\"/>\n                </bean-instance-pools>\n            </pools>\n            <caches>\n                <cache name=\"simple\"/>\n                <cache name=\"distributable\" passivation-store-ref=\"infinispan\" aliases=\"passivating clustered\"/>\n            </caches>\n            <passivation-stores>\n                <passivation-store name=\"infinispan\" cache-container=\"ejb\" max-size=\"10000\"/>\n            </passivation-stores>\n            <async thread-pool-name=\"default\"/>\n            <timer-service thread-pool-name=\"default\" default-data-store=\"default-file-store\">\n                <data-stores>\n                    <file-data-store name=\"default-file-store\" path=\"timer-service-data\" relative-to=\"jboss.server.data.dir\"/>\n                </data-stores>\n            </timer-service>\n            <remote connector-ref=\"http-remoting-connector\" thread-pool-name=\"default\">\n                <channel-creation-options>\n                    <option name=\"READ_TIMEOUT\" value=\"${prop.remoting-connector.read.timeout:20}\" type=\"xnio\"/>\n                    <option name=\"MAX_OUTBOUND_MESSAGES\" value=\"1234\" type=\"remoting\"/>\n                </channel-creation-options>\n            </remote>\n            <thread-pools>\n                <thread-pool name=\"default\">\n                    <max-threads count=\"10\"/>\n                    <keepalive-time time=\"100\" unit=\"milliseconds\"/>\n                </thread-pool>\n            </thread-pools>\n            <default-security-domain value=\"other\"/>\n            <default-missing-method-permissions-deny-access value=\"true\"/>\n            <log-system-exceptions value=\"true\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:wildfly:elytron:5.0\" final-providers=\"combined-providers\" disallowed-providers=\"OracleUcrypto\">\n            <providers>\n                <aggregate-providers name=\"combined-providers\">\n                    <providers name=\"elytron\"/>\n                    <providers name=\"openssl\"/>\n                </aggregate-providers>\n                <provider-loader name=\"elytron\" module=\"org.wildfly.security.elytron\"/>\n                <provider-loader name=\"openssl\" module=\"org.wildfly.openssl\"/>\n            </providers>\n            <audit-logging>\n                <file-audit-log name=\"local-audit\" path=\"audit.log\" relative-to=\"jboss.server.log.dir\" format=\"JSON\"/>\n            </audit-logging>\n            <security-domains>\n                <security-domain name=\"ApplicationDomain\" default-realm=\"ApplicationRealm\" permission-mapper=\"default-permission-mapper\">\n                    <realm name=\"ApplicationRealm\" role-decoder=\"groups-to-roles\"/>\n                    <realm name=\"local\"/>\n                </security-domain>\n                <security-domain name=\"ManagementDomain\" default-realm=\"ManagementRealm\" permission-mapper=\"default-permission-mapper\">\n                    <realm name=\"ManagementRealm\" role-decoder=\"groups-to-roles\"/>\n                    <realm name=\"local\" role-mapper=\"super-user-mapper\"/>\n                </security-domain>\n            </security-domains>\n            <security-realms>\n                <identity-realm name=\"local\" identity=\"$local\"/>\n                <properties-realm name=\"ApplicationRealm\">\n                    <users-properties path=\"application-users.properties\" relative-to=\"jboss.server.config.dir\" digest-realm-name=\"ApplicationRealm\"/>\n                    <groups-properties path=\"application-roles.properties\" relative-to=\"jboss.server.config.dir\"/>\n                </properties-realm>\n                <properties-realm name=\"ManagementRealm\">\n                    <users-properties path=\"mgmt-users.properties\" relative-to=\"jboss.server.config.dir\" digest-realm-name=\"ManagementRealm\"/>\n                    <groups-properties path=\"mgmt-groups.properties\" relative-to=\"jboss.server.config.dir\"/>\n                </properties-realm>\n            </security-realms>\n            <mappers>\n                <simple-permission-mapper name=\"default-permission-mapper\" mapping-mode=\"first\">\n                    <permission-mapping>\n                        <principal name=\"anonymous\"/>\n                        <permission-set name=\"default-permissions\"/>\n                    </permission-mapping>\n                    <permission-mapping match-all=\"true\">\n                        <permission-set name=\"login-permission\"/>\n                        <permission-set name=\"default-permissions\"/>\n                    </permission-mapping>\n                </simple-permission-mapper>\n                <constant-realm-mapper name=\"local\" realm-name=\"local\"/>\n                <simple-role-decoder name=\"groups-to-roles\" attribute=\"groups\"/>\n                <constant-role-mapper name=\"super-user-mapper\">\n                    <role name=\"SuperUser\"/>\n                </constant-role-mapper>\n            </mappers>\n            <permission-sets>\n                <permission-set name=\"login-permission\">\n                    <permission class-name=\"org.wildfly.security.auth.permission.LoginPermission\"/>\n                </permission-set>\n                <permission-set name=\"default-permissions\">\n                    <permission class-name=\"org.wildfly.extension.batch.jberet.deployment.BatchPermission\" module=\"org.wildfly.extension.batch.jberet\" target-name=\"*\"/>\n                    <permission class-name=\"org.wildfly.transaction.client.RemoteTransactionPermission\" module=\"org.wildfly.transaction.client\"/>\n                    <permission class-name=\"org.jboss.ejb.client.RemoteEJBPermission\" module=\"org.jboss.ejb-client\"/>\n                </permission-set>\n            </permission-sets>\n            <http>\n                <http-authentication-factory name=\"management-http-authentication\" security-domain=\"ManagementDomain\" http-server-mechanism-factory=\"global\">\n                    <mechanism-configuration>\n                        <mechanism mechanism-name=\"DIGEST\">\n                            <mechanism-realm realm-name=\"ManagementRealm\"/>\n                        </mechanism>\n                    </mechanism-configuration>\n                </http-authentication-factory>\n                <provider-http-server-mechanism-factory name=\"global\"/>\n            </http>\n            <sasl>\n                <sasl-authentication-factory name=\"application-sasl-authentication\" sasl-server-factory=\"configured\" security-domain=\"ApplicationDomain\">\n                    <mechanism-configuration>\n                        <mechanism mechanism-name=\"JBOSS-LOCAL-USER\" realm-mapper=\"local\"/>\n                        <mechanism mechanism-name=\"DIGEST-MD5\">\n                            <mechanism-realm realm-name=\"ApplicationRealm\"/>\n                        </mechanism>\n                    </mechanism-configuration>\n                </sasl-authentication-factory>\n                <sasl-authentication-factory name=\"management-sasl-authentication\" sasl-server-factory=\"configured\" security-domain=\"ManagementDomain\">\n                    <mechanism-configuration>\n                        <mechanism mechanism-name=\"JBOSS-LOCAL-USER\" realm-mapper=\"local\"/>\n                        <mechanism mechanism-name=\"DIGEST-MD5\">\n                            <mechanism-realm realm-name=\"ManagementRealm\"/>\n                        </mechanism>\n                    </mechanism-configuration>\n                </sasl-authentication-factory>\n                <configurable-sasl-server-factory name=\"configured\" sasl-server-factory=\"elytron\">\n                    <properties>\n                        <property name=\"wildfly.sasl.local-user.default-user\" value=\"$local\"/>\n                    </properties>\n                </configurable-sasl-server-factory>\n                <mechanism-provider-filtering-sasl-server-factory name=\"elytron\" sasl-server-factory=\"global\">\n                    <filters>\n                        <filter provider-name=\"WildFlyElytron\"/>\n                    </filters>\n                </mechanism-provider-filtering-sasl-server-factory>\n                <provider-sasl-server-factory name=\"global\"/>\n            </sasl>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:infinispan:7.0\">\n            <cache-container name=\"server\" default-cache=\"default\" module=\"org.wildfly.clustering.server\">\n                <local-cache name=\"default\">\n                    <transaction mode=\"BATCH\"/>\n                </local-cache>\n            </cache-container>\n            <cache-container name=\"web\" default-cache=\"passivation\" module=\"org.wildfly.clustering.web.infinispan\">\n                <local-cache name=\"passivation\">\n                    <locking isolation=\"REPEATABLE_READ\"/>\n                    <transaction mode=\"BATCH\"/>\n                    <file-store passivation=\"true\" purge=\"false\"/>\n                </local-cache>\n            </cache-container>\n            <cache-container name=\"ejb\" aliases=\"sfsb\" default-cache=\"passivation\" module=\"org.wildfly.clustering.ejb.infinispan\">\n                <local-cache name=\"passivation\">\n                    <locking isolation=\"REPEATABLE_READ\"/>\n                    <transaction mode=\"BATCH\"/>\n                    <file-store passivation=\"true\" purge=\"false\"/>\n                </local-cache>\n            </cache-container>\n            <cache-container name=\"hibernate\" module=\"org.infinispan.hibernate-cache\">\n                <local-cache name=\"entity\">\n                    <transaction mode=\"NON_XA\"/>\n                    <object-memory size=\"10000\"/>\n                    <expiration max-idle=\"100000\"/>\n                </local-cache>\n                <local-cache name=\"local-query\">\n                    <object-memory size=\"10000\"/>\n                    <expiration max-idle=\"100000\"/>\n                </local-cache>\n                <local-cache name=\"timestamps\"/>\n            </cache-container>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:io:3.0\">\n            <worker name=\"default\"/>\n            <buffer-pool name=\"default\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:jaxrs:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:jca:5.0\">\n            <archive-validation enabled=\"true\" fail-on-error=\"true\" fail-on-warn=\"false\"/>\n            <bean-validation enabled=\"true\"/>\n            <default-workmanager>\n                <short-running-threads>\n                    <core-threads count=\"50\"/>\n                    <queue-length count=\"50\"/>\n                    <max-threads count=\"50\"/>\n                    <keepalive-time time=\"10\" unit=\"seconds\"/>\n                </short-running-threads>\n                <long-running-threads>\n                    <core-threads count=\"50\"/>\n                    <queue-length count=\"50\"/>\n                    <max-threads count=\"50\"/>\n                    <keepalive-time time=\"10\" unit=\"seconds\"/>\n                </long-running-threads>\n            </default-workmanager>\n            <cached-connection-manager/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:jdr:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:jmx:1.3\">\n            <expose-resolved-model/>\n            <expose-expression-model/>\n            <remoting-connector/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:jpa:1.1\">\n            <jpa default-datasource=\"\" default-extended-persistence-inheritance=\"DEEP\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:jsf:1.1\"/>\n        <subsystem xmlns=\"urn:jboss:domain:mail:3.0\">\n            <mail-session name=\"default\" jndi-name=\"java:jboss/mail/Default\">\n                <smtp-server outbound-socket-binding-ref=\"mail-smtp\"/>\n            </mail-session>\n        </subsystem>\n        <subsystem xmlns=\"urn:wildfly:microprofile-config-smallrye:1.0\"/>\n        <subsystem xmlns=\"urn:wildfly:microprofile-health-smallrye:1.0\" security-enabled=\"false\"/>\n        <subsystem xmlns=\"urn:wildfly:microprofile-metrics-smallrye:1.0\" security-enabled=\"false\" exposed-subsystems=\"*\"/>\n        <subsystem xmlns=\"urn:wildfly:microprofile-opentracing-smallrye:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:naming:2.0\">\n            <remote-naming/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:pojo:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:remoting:4.0\">\n            <http-connector name=\"http-remoting-connector\" connector-ref=\"default\" security-realm=\"ApplicationRealm\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:request-controller:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:resource-adapters:5.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:sar:1.0\"/>\n        <subsystem xmlns=\"urn:jboss:domain:security:2.0\">\n            <security-domains>\n                <security-domain name=\"other\" cache-type=\"default\">\n                    <authentication>\n                        <login-module code=\"Remoting\" flag=\"optional\">\n                            <module-option name=\"password-stacking\" value=\"useFirstPass\"/>\n                        </login-module>\n                        <login-module code=\"RealmDirect\" flag=\"required\">\n                            <module-option name=\"password-stacking\" value=\"useFirstPass\"/>\n                        </login-module>\n                    </authentication>\n                </security-domain>\n                <security-domain name=\"jboss-web-policy\" cache-type=\"default\">\n                    <authorization>\n                        <policy-module code=\"Delegating\" flag=\"required\"/>\n                    </authorization>\n                </security-domain>\n                <security-domain name=\"jaspitest\" cache-type=\"default\">\n                    <authentication-jaspi>\n                        <login-module-stack name=\"dummy\">\n                            <login-module code=\"Dummy\" flag=\"optional\"/>\n                        </login-module-stack>\n                        <auth-module code=\"Dummy\"/>\n                    </authentication-jaspi>\n                </security-domain>\n                <security-domain name=\"jboss-ejb-policy\" cache-type=\"default\">\n                    <authorization>\n                        <policy-module code=\"Delegating\" flag=\"required\"/>\n                    </authorization>\n                </security-domain>\n            </security-domains>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:security-manager:1.0\">\n            <deployment-permissions>\n                <maximum-set>\n                    <permission class=\"java.security.AllPermission\"/>\n                </maximum-set>\n            </deployment-permissions>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:transactions:5.0\">\n            <core-environment node-identifier=\"${jboss.tx.node.id:1}\">\n                <process-id>\n                    <uuid/>\n                </process-id>\n            </core-environment>\n            <recovery-environment socket-binding=\"txn-recovery-environment\" status-socket-binding=\"txn-status-manager\"/>\n            <object-store path=\"tx-object-store\" relative-to=\"jboss.server.data.dir\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:undertow:8.0\" default-server=\"default-server\" default-virtual-host=\"default-host\" default-servlet-container=\"default\" default-security-domain=\"other\">\n            <buffer-cache name=\"default\"/>\n            <server name=\"default-server\">\n                <http-listener name=\"default\" socket-binding=\"http\" redirect-socket=\"https\" enable-http2=\"true\"/>\n                <ajp-listener name=\"ajp\" socket-binding=\"ajp\"/>\n                <https-listener name=\"https\" socket-binding=\"https\" security-realm=\"ApplicationRealm\" enable-http2=\"true\"/>\n                <host name=\"default-host\" alias=\"localhost\">\n                    <location name=\"/\" handler=\"welcome-content\"/>\n                    <http-invoker security-realm=\"ApplicationRealm\"/>\n                </host>\n            </server>\n            <servlet-container name=\"default\">\n                <jsp-config/>\n                <websockets/>\n            </servlet-container>\n            <handlers>\n                <file name=\"welcome-content\" path=\"${jboss.home.dir}/welcome-content\"/>\n            </handlers>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:webservices:2.0\">\n            <wsdl-host>${jboss.bind.address:127.0.0.1}</wsdl-host>\n            <endpoint-config name=\"Standard-Endpoint-Config\"/>\n            <endpoint-config name=\"Recording-Endpoint-Config\">\n                <pre-handler-chain name=\"recording-handlers\" protocol-bindings=\"##SOAP11_HTTP ##SOAP11_HTTP_MTOM ##SOAP12_HTTP ##SOAP12_HTTP_MTOM\">\n                    <handler name=\"RecordingHandler\" class=\"org.jboss.ws.common.invocation.RecordingServerHandler\"/>\n                </pre-handler-chain>\n            </endpoint-config>\n            <client-config name=\"Standard-Client-Config\"/>\n        </subsystem>\n        <subsystem xmlns=\"urn:jboss:domain:weld:4.0\"/>\n    </profile>\n    <interfaces>\n        <interface name=\"management\">\n            <inet-address value=\"${jboss.bind.address.management:127.0.0.1}\"/>\n        </interface>\n        <interface name=\"public\">\n            <inet-address value=\"${jboss.bind.address:127.0.0.1}\"/>\n        </interface>\n    </interfaces>\n    <socket-binding-group name=\"standard-sockets\" default-interface=\"public\" port-offset=\"${jboss.socket.binding.port-offset:0}\">\n        <socket-binding name=\"management-http\" interface=\"management\" port=\"${jboss.management.http.port:9990}\"/>\n        <socket-binding name=\"management-https\" interface=\"management\" port=\"${jboss.management.https.port:9993}\"/>\n        <socket-binding name=\"ajp\" port=\"${jboss.ajp.port:8009}\"/>\n        <socket-binding name=\"http\" port=\"${jboss.http.port:8080}\"/>\n        <socket-binding name=\"https\" port=\"${jboss.https.port:8443}\"/>\n        <socket-binding name=\"txn-recovery-environment\" port=\"4712\"/>\n        <socket-binding name=\"txn-status-manager\" port=\"4713\"/>\n        <outbound-socket-binding name=\"mail-smtp\">\n            <remote-destination host=\"localhost\" port=\"25\"/>\n        </outbound-socket-binding>\n    </socket-binding-group>\n</server>\n"
    kind: ConfigMap
    metadata:
      name: standalone.xml

######




  parameters:
    - name: APP_NAME
      displayName: Nombre del microservicio
      value: ''
      required: true
    - name: WILDFLY_VERSION
      displayName: Versión de Wildfly a utilizar
      value: '15'
      required: true
    - name: VERSION_JDK
      displayName: Versión de JDK
      value: '11'
      required: true
    - name: REPO_GIT
      displayName: Repositorio git donde se encuentra la aplicacion
      value: ""
      required: true
    - name: BRANCH_GIT
      displayName: Nombre del branch del repositorio
      value: ""
      required: true
    - name: SOURCE_SECRET
      displayName: Nombre del secret para autenticacion con el git
      value: ""
    - name: MVN_OPTS
      displayName: Argumentos adicionales maven. Valores por defecto (clean package -Dfile.encoding=UTF-8 -DskipTests=true)
      value: ""
    - name: NEXUS_MIRROR_URL
      displayName: Especifique repositorio nexus para la descarga de las dependencias. Recomendado
      value: ""
    - name: EXTRA_REPO
      displayName: Repositorio git adicional para compilar previo al microservicio. Ej shared
      value: ""
    - name: CUSTOM_JAVA_OPTS
      displayName: Parametros jvm para el inicio del microservicio
      value: ""
